<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 50px;
                padding-bottom: 20px;
            }
        </style>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <!-- pages/navigation.html
      ELEMENT ŁADOWANY PO ZAŁADOWANIU JQUERY (na dole skrypt ładujący) -->

    </nav>



    <div class="container">
      <div class="row clearfix">
        <div class="col-md-12 column">
        <ul class="nav nav-tabs">
                <li class="active">
                  <a href="#">Strona główna</a>
                </li>
                <li class="disabled" data-toggle="tooltip"  data-placement="bottom" data-original-title="Musisz się zaglogować">
                  <a href="#">Zobacz liste moich zakupów</a>
                </li>
                <li class="disabled" data-toggle="tooltip"  data-placement="bottom" data-original-title="Musisz się zaglogować jako administrator">
                  <a href="#">Zobacz listę wszystkich zakupów</a>
                </li>
              </ul>
      <div class="alert alert-success alert-dismissable" id="alert" style="display:none;">
         <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
        <div id="alertMessage"></div>
      </div>
          <div class="page-header">
          <h1>
            Strona z filmami <small>Wybierz i kup film</small>
          </h1>
        </div>

          <div class="row" id="products">
            <!-- Produkty ładowane przez jQuery z użyciem ajaxa (na dole strony skrypt ładujący) -->
          </div>
        </div>
    </div>

      <hr>

      <footer>
        <p>&copy; Company 2014</p>
      </footer>
    </div> <!-- /container -->     

    <!-- Modalne okno rejestracji -->
        <div class="modal fade" id="modal-registration" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">
                  Rejestruj nowe konto
                </h4>
              </div>
              <div class="modal-body">
                
                      <form role="form" id="registrationForm">
                        <div class="form-group">
                           <label for="reg_username">Podaj nazwę użykownika:</label>
                           <input type="text" class="form-control" name="reg_username" id="reg_username" required oninput="checkLogin(this)"/>
                        </div>
                        <div class="form-group">
                           <label for="reg_password">Podaj hasło</label>
                           <input type="password" class="form-control" name="reg_password" id="reg_password" required/>
                        </div>
                          <div class="form-group">
                           <label for="reg_password_check">Powtórz hasło</label>
                           <input type="password" class="form-control" name="reg_password_check" id="reg_password_check" required oninput="checkPasswords(this)"/>
                        </div>
                        <!-- Potrzebny ten input (mimo tego ze wysyłamy ajax'em prze jQuery), aby wykorzystac pokazywanie błędów przez HTML5 -->
                        <input type="submit" style="display:none">
                      </form>
                   
              </div>
              <div class="modal-footer">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Anuluj</button>
                 <button type="button" class="btn btn-primary" onclick="registration()">Rejestruj</button>
              </div>
            </div>
            
          </div>
        </div>

        <!-- Ładowanie skryptów -->
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.1.min.js"><\/script>')</script>

        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/main.js"></script>

        <script>
        // Ładuj obsłgue tooltipów (podpowiedzi)
          $(document).ready(function(){
              $('[data-toggle="tooltip"]').tooltip();   
          });

          function loadNavigation(){
            $('nav').load('/pages/navigation.php');
          }
          function loadProducts(){
            $('#products').load('/pages/products.php');
          }
          //Pokazywanie błędow np. login jest zajęty przy rejestracji -->
          function showRegError(){
            var $myForm = $('#registrationForm')
                            if (!$myForm[0].checkValidity()) {
                              // If the form is invalid, submit it. The form won't actually submit;
                              // this will just cause the browser to display the native HTML5 error messages.
                              $myForm.find(':submit').click()
                            }
          }

          function showLoginError(){
            var $myForm = $('form#loginForm');
            if (!$myForm[0].checkValidity()) {
                              $myForm.find(':submit').click();
                              return false;
            }
            return true;
          }
          loadNavigation();
          loadProducts();

          // Funkcja wykorzystująca możliwosci HTML5 do sprawdzania czy hasła są takie same przy rejestracji
          function checkPasswords(input) {
              if (input.value != document.getElementById('reg_password').value) {
                  input.setCustomValidity('Hasła muszą byc takie same!');
              } else {
                  // input is valid -- reset the error message
                  input.setCustomValidity('');
             }
          
          }
          // Funkcja sprawdzająca czy login jest wolny
          function checkLogin(input) {

              if (input.value.length > 3){
                  $.getJSON( "/pages/checkUserName.php?login="+input.value, 
                    function( data )
                    {    
                      // Pobieramy dane ze strony PHP (która łączy się z baza danych i daje nam odpowiedź czy login jest juz w bazie)
                      if (data.isFree != 1)
                      {
                          //Wykorzusyujemy dobrodziejstwa HTML5 (niestety prawdopodbnie strona będzie dzialac poprawnie tylko na CHROMIE)
                          input.setCustomValidity('Ten login jest zajęty'); 
                          showRegError();
                      } else {
                            // input is valid -- reset the error message
                            input.setCustomValidity('');
                       }
                        });
                }
          
          }

          // Funkcja wysyłające dane do rejestracji
          function registration(){
            showRegError();
            // sprawdzamy czy hasła sa takie same
           // checkPasswords();
          }

          // funkcja odpowiedzialna za logowanie
          function login(){
            if (!showLoginError())
              return;
              $.post( 'pages/logincheck.php', $('form#loginForm').serialize(), function(data) {
                   // Jeśli pomyślnie się zalogowalismy przeładuj pasek navigation.php
                   if (data.success != 1){
                    // Wyswietl że błędny login lub hasło (działa prawdopodobnie tylok na chromie)
                      document.getElementById('password').setCustomValidity('Błędny login lub hasło');
                      showLoginError();
                      //setTimeout(function(){document.getElementById('password').setCustomValidity('')}, 2000);
                   }
                 },
                 'json' // I expect a JSON response
              );
          }
          // funkcja odpowiedzialna za wylogowywanie
          function logout(){
              $.get('pages/logout.php');
              showAlert('Pomyslnie zostałeś wylogowany', 'wylogowano');

          }
          //funkcja wyświetlająca aktualne wiadomośc (np. wylogowano)
          function showAlert(message, title){
            $('#alertMessage').html("<strong>"+title+"!</strong> "+message+".");
            $('#alert').fadeIn('slow');
            // przez 2,5 s pokazuje info
            setTimeout(function(){ $('#alert').fadeOut('slow') }, 2500);
          }
        </script
    </body>
</html>
